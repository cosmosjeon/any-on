# Anyon 프론트엔드 아키텍쳐 상세 문서

**프로젝트:** Anyon - 프론트엔드
**버전:** 0.0.116
**프레임워크:** React 18 + TypeScript + Vite
**UI 라이브러리:** shadcn/ui + Tailwind CSS
**상태 관리:** React Query + Zustand + Context API
**작성일:** 2025-01-08

---

## 목차

1. [프론트엔드 기술 스택 상세](#1-프론트엔드-기술-스택-상세)
2. [프로젝트 구조](#2-프로젝트-구조)
3. [컴포넌트 아키텍쳐](#3-컴포넌트-아키텍쳐)
4. [상태 관리 전략](#4-상태-관리-전략)
5. [API 통합](#5-api-통합)
6. [실시간 기능](#6-실시간-기능)
7. [라우팅 및 네비게이션](#7-라우팅-및-네비게이션)
8. [스타일링 아키텍쳐](#8-스타일링-아키텍쳐)
9. [타입 시스템](#9-타입-시스템)
10. [빌드 및 개발 환경](#10-빌드-및-개발-환경)
11. [주요 기능 구현 상세](#11-주요-기능-구현-상세)
12. [개발 모범 사례](#12-개발-모범-사례)
13. [성능 최적화 전략](#13-성능-최적화-전략)

---

## 1. 프론트엔드 기술 스택 상세

### 1.1 React & 핵심 프레임워크

| 기술 | 버전 | 용도 | 특징 |
|-----|------|-----|------|
| **React** | 18.2.0 | UI 라이브러리 | 최신 안정 버전, Concurrent 기능 지원 |
| **React DOM** | 18.2.0 | DOM 렌더링 | React 18 최신 기능 |
| **Vite** | 5.0.8 | 빌드 도구 | 빠른 HMR, ES 모듈 기반 번들링 |
| **TypeScript** | 5.9.2 | 타입 시스템 | Strict 모드 활성화 |
| **React Router** | 6.8.1 | 클라이언트 라우팅 | 중첩 라우팅, URL 기반 상태 |

### 1.2 UI 프레임워크 & 스타일링

#### **Tailwind CSS 생태계**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **Tailwind CSS** | 3.4.0 | 유틸리티 우선 CSS 프레임워크 |
| **@tailwindcss/container-queries** | - | 컨테이너 쿼리 지원 |
| **tailwindcss-animate** | - | 애니메이션 플러그인 |
| **tailwind-merge** | 2.2.0 | Tailwind 클래스 병합 |

**Tailwind 설정 특징:**
```javascript
// 다크 모드: class 전략 사용
darkMode: ["class"]

// 커스텀 테마 토큰 (CSS 변수 기반)
colors: {
  border, input, ring,
  background, foreground,
  primary, secondary, destructive,
  muted, accent, success, warning,
  info, neutral, status, console
}

// 폰트 크기 다운시프트 (1단계씩 작게)
fontSize: { xs, sm, base, lg, xl }

// 커스텀 폰트
fontFamily: {
  'chivo-mono': ['Chivo Mono', 'Noto Emoji', 'monospace']
}
```

#### **shadcn/ui 컴포넌트**
Radix UI 기반 Headless 컴포넌트 라이브러리:
```
사용 중인 컴포넌트:
• Button, Badge, Alert, Breadcrumb
• Card (CardHeader, CardContent, CardDescription)
• Dialog, Dropdown Menu, Tooltip
• Select, Input, Textarea, Checkbox, Label
• Tabs, Toggle, Toggle Group
• Table (정렬/필터링 DataTable)
• Accordion, Alert
```

#### **Radix UI 프리미티브**
| 패키지 | 버전 | 용도 |
|--------|------|-----|
| @radix-ui/react-dropdown-menu | 2.1.15 | 드롭다운 메뉴 |
| @radix-ui/react-label | 2.1.7 | 라벨 컴포넌트 |
| @radix-ui/react-select | 2.2.5 | 셀렉트 박스 |
| @radix-ui/react-tabs | 1.1.12 | 탭 컴포넌트 |
| @radix-ui/react-tooltip | 1.2.7 | 툴팁 |
| @radix-ui/react-toggle-group | 1.1.11 | 토글 그룹 |
| @radix-ui/react-slot | 1.2.3 | 슬롯 컴포지션 |

#### **애니메이션 & 모션**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **Framer Motion** | 12.23.24 | 고급 애니메이션 라이브러리 |

**사용 사례:**
- 패널 트랜지션
- 모달 애니메이션
- AnimatePresence로 레이아웃 변경

### 1.3 상태 관리 & 데이터 페칭

#### **React Query (TanStack Query)**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **@tanstack/react-query** | 5.85.5 | 서버 상태 관리 |

**설정:**
```typescript
// main.tsx에서 QueryClient 설정
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,     // 5분 stale time
      refetchOnWindowFocus: false,   // 윈도우 포커스 시 refetch 비활성화
    },
  },
});
```

**사용 통계:**
- 59개 `useQuery` 및 `useMutation` 사용
- 15개 이상의 API 객체 그룹

#### **Zustand**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **zustand** | 4.5.4 | 경량 글로벌 상태 관리 |

**사용 중인 스토어:**
```typescript
// 1. Diff 뷰 모드 스토어
useDiffViewStore {
  mode: 'unified' | 'split'
  setMode(mode: DiffViewMode): void
  toggle(): void
  ignoreWhitespace: boolean
  setIgnoreWhitespace(value: boolean): void
}

// 2. 작업 상세 UI 스토어
useTaskDetailsUiStore {
  // 작업 관련 UI 상태
}

// 3. 확장 가능 섹션 스토어
useExpandableStore {
  // 섹션 확장 상태
}
```

#### **Context API**
**다중 컨텍스트 사용:**
```typescript
// 1. UserSystemProvider - 시스템 설정
UserSystemProvider {
  config: Config
  environment: Environment
  profiles: Record<string, ExecutorConfig>
  capabilities: Record<string, BaseAgentCapability[]>
  analyticsUserId: string
  updateAndSaveConfig(updates: Partial<Config>): Promise<boolean>
  reloadSystem(): Promise<void>
}

// 2. ProjectProvider - 현재 프로젝트
ProjectContext {
  projectId: string | undefined
  project: Project | undefined
  isLoading: boolean
  error: Error | null
}

// 3. SearchProvider - 전역 검색
SearchContext {
  query: string
  focusInput: () => void
}

// 4. ThemeProvider - 테마
ThemeContext {
  theme: ThemeMode
  setTheme: (theme: ThemeMode) => void
}
```

### 1.4 실시간 통신 & WebSocket

| 기술 | 버전 | 용도 |
|-----|------|-----|
| **react-use-websocket** | 4.7.0 | 저수준 WebSocket 지원 |
| **EventSource API** | 네이티브 | Server-Sent Events |

**커스텀 WebSocket 훅:**
```typescript
useJsonPatchWsStream<T>(
  endpoint: string | undefined,
  enabled: boolean,
  initialData: () => T,
  options?: {
    injectInitialEntry?: (data: T) => void;
    deduplicatePatches?: (patches: Operation[]) => Operation[];
  }
): UseJsonPatchStreamResult<T>
```

**특징:**
- JSON Patch (RFC 6902) 프로토콜 구현
- 자동 재연결 (지수 백오프: 1s, 2s, 4s, 8s 최대)
- 중복 제거 및 초기 데이터 주입 지원
- 제네릭 상태 객체에 대한 타입 지원

### 1.5 텍스트 에디터 & 리치 콘텐츠

#### **Lexical - 리치 텍스트 에디터**
| 패키지 | 버전 | 용도 |
|--------|------|-----|
| **lexical** | 0.36.2 | Meta의 리치 텍스트 에디터 프레임워크 |
| **@lexical/react** | 0.36.2 | React 통합 |
| **@lexical/rich-text** | 0.36.2 | 리치 텍스트 기능 |
| **@lexical/code** | 0.36.2 | 코드 블록 |
| **@lexical/list** | 0.36.2 | 리스트 지원 |
| **@lexical/link** | 0.36.2 | 링크 기능 |
| **@lexical/markdown** | 0.36.2 | 마크다운 지원 |

**기능:**
- 마크다운 지원
- 코드 블록, 리스트, 링크
- 커스텀 이미지 칩 노드

#### **CodeMirror - 코드 에디터**
| 패키지 | 버전 | 용도 |
|--------|------|-----|
| **codemirror** | 6.38.1 | 코드 에디터 |
| **@codemirror/lang-json** | 6.x | JSON 언어 지원 |
| **@codemirror/lint** | 6.x | 린팅 |
| **@uiw/react-codemirror** | 4.25.1 | React 래퍼 |

#### **Git Diff 뷰어**
| 패키지 | 버전 | 용도 |
|--------|------|-----|
| **@git-diff-view/react** | - | React Git diff 뷰어 |
| **@git-diff-view/file** | - | 파일 diff 처리 |

**지원 모드:**
- Unified diff 모드
- Split diff 모드
- 구문 강조

### 1.6 고급 UI 패턴

#### **Drag & Drop**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **@dnd-kit/core** | 6.3.1 | 핵심 드래그 기능 |
| **@dnd-kit/modifiers** | 6.3.1 | 드래그 수정자 |
| **@dnd-kit/utilities** | 6.3.1 | 유틸리티 |

**용도:** 작업 칸반 보드 드래깅

#### **Virtualization (가상화)**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **react-virtuoso** | 4.14.0 | 고급 가상 리스트 |
| **react-window** | 1.8.11 | 가상 그리드 |
| **@virtuoso.dev/message-list** | 1.13.3 | 가상 메시지 리스트 |

**사용 사례:**
- 프로세스 로그 뷰어 (10,000+ 라인)
- 작업 리스트
- 대화 내역

#### **Panel Resizing**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **react-resizable-panels** | 3.0.6 | 드래그 가능한 패널 크기 조정 |

**특징:**
- 2단계 패널 계층 (작업 레이아웃용)
- LocalStorage에 패널 크기 지속성

#### **Modal 관리**
| 기술 | 버전 | 용도 |
|-----|------|-----|
| **@ebay/nice-modal-react** | 1.2.13 | 모달 관리 |

**특징:**
- 25개 이상 등록된 모달
- Promise 기반 다이얼로그 API

### 1.7 JSON Schema Form

| 패키지 | 버전 | 용도 |
|--------|------|-----|
| **@rjsf/shadcn** | 6.0.0-beta.10 | shadcn UI 테마 JSON Schema 폼 |

**커스텀 위젯:**
- TextWidget
- CheckboxWidget
- TextareaWidget
- SelectWidget

**커스텀 템플릿:**
- FieldTemplate
- FormTemplate
- ObjectFieldTemplate
- ArrayFieldTemplate

### 1.8 국제화 (i18n)

| 기술 | 버전 | 용도 |
|-----|------|-----|
| **i18next** | 25.5.2 | i18n 프레임워크 |
| **react-i18next** | 15.7.3 | React 통합 |
| **i18next-browser-languagedetector** | 8.2.0 | 자동 언어 감지 |

**지원 언어:**
- Browser default
- English (en)
- Japanese (ja)
- Spanish (es)
- Korean (ko)

### 1.9 모니터링 & 에러 추적

| 기술 | 버전 | 용도 |
|-----|------|-----|
| **@sentry/react** | 9.34.0 | 에러 추적 |
| **posthog-js** | 1.276.0 | 제품 분석 |

**Sentry 설정:**
```typescript
Sentry.init({
  dsn: "...",
  environment: import.meta.env.DEV ? "dev" : "production",
  integrations: [
    new Sentry.BrowserTracing({
      routingInstrumentation: Sentry.reactRouterV6Instrumentation(
        React.useEffect,
        useLocation,
        useNavigationType,
        createRoutesFromChildren,
        matchRoutes
      ),
    }),
  ],
});
```

**PostHog 설정:**
- 사용자 동의에 따른 선택적 분석
- 사용자 식별
- 이벤트 캡처

### 1.10 기타 주요 라이브러리

| 라이브러리 | 버전 | 용도 |
|-----------|------|-----|
| **fancy-ansi** | 0.1.3 | 콘솔 로그용 ANSI 색상 파싱 |
| **lodash** | 4.17.21 | 유틸리티 라이브러리 |
| **lucide-react** | 0.539.0 | 아이콘 라이브러리 |
| **clsx** | 2.0.0 | 클래스명 유틸리티 |
| **markdown-to-jsx** | 7.7.13 | 마크다운 렌더링 |
| **embla-carousel-react** | 8.6.0 | 캐러셀 컴포넌트 |
| **simple-icons** | 15.16.0 | 아이콘 세트 |
| **react-hotkeys-hook** | 5.1.0 | 키보드 단축키 |
| **rfc6902** | 5.1.2 | JSON Patch 구현 |

---

## 2. 프로젝트 구조

### 2.1 전체 디렉토리 구조

```
frontend/src/
├── components/              # React 컴포넌트 (주요 디렉토리)
│   ├── common/             # 공유 컴포넌트
│   │   ├── ProfileVariantBadge.tsx
│   │   ├── RawLogText.tsx
│   │   └── ...
│   ├── dialogs/            # 25+ 모달 다이얼로그
│   │   ├── global/         # 온보딩, 면책조항, 개인정보, 릴리스 노트
│   │   ├── auth/           # GitHub 로그인, PAT 제공자
│   │   ├── tasks/          # 작업 폼, PR 생성, 에디터 선택
│   │   ├── projects/       # 프로젝트 폼, 에디터 선택
│   │   ├── settings/       # 설정 다이얼로그
│   │   ├── shared/         # 확인, 폴더 선택기
│   │   └── index.ts        # 중앙 다이얼로그 내보내기
│   ├── ide/                # IDE 통합 컴포넌트
│   ├── layout/
│   │   ├── NormalLayout.tsx      # 네비바가 있는 메인 앱 레이아웃
│   │   ├── TasksLayout.tsx       # 반응형 칸반 + 상세 패널
│   │   ├── ResponsiveTwoPane.tsx # 2-패널 레이아웃 유틸리티
│   ├── panels/             # 작업 시도 상세, diff, 미리보기
│   │   ├── TaskAttemptPanel.tsx
│   │   ├── TaskPanel.tsx
│   │   ├── DiffsPanel.tsx
│   │   ├── PreviewPanel.tsx
│   │   ├── AttemptHeaderActions.tsx
│   ├── rjsf/               # JSON Schema 폼 커스터마이징
│   │   ├── templates/      # Field, form, object, array 템플릿
│   │   ├── widgets/        # Text, textarea, checkbox, select 위젯
│   │   ├── theme.ts
│   ├── tasks/              # 작업 관련 컴포넌트
│   │   ├── TaskCard.tsx          # 칸반 카드
│   │   ├── TaskKanbanBoard.tsx   # 메인 보드
│   │   ├── TaskDetails/
│   │   │   ├── ProcessesTab.tsx      # 실행 프로세스
│   │   │   ├── ProcessLogsViewer.tsx # 가상화된 로그
│   │   ├── follow-up/            # 후속 시도 기능
│   │   ├── TaskRelationshipViewer.tsx
│   │   ├── TodoPanel.tsx
│   │   └── Toolbar/              # Git 작업 툴바
│   ├── projects/           # 프로젝트 관리 UI
│   │   ├── project-list.tsx
│   │   ├── project-detail.tsx
│   │   ├── ProjectCard.tsx
│   │   ├── project-form-fields.tsx
│   ├── ui/                 # shadcn/ui 컴포넌트
│   │   ├── button.tsx, card.tsx, dialog.tsx, etc.
│   │   ├── shadcn-io/kanban/   # 커스텀 칸반 컴포넌트
│   │   ├── wysiwyg/            # Lexical 에디터 컴포넌트
│   │   ├── table/              # 정렬/필터링 DataTable
│   ├── showcase/           # 기능 쇼케이스 모달
│   ├── theme-provider.tsx  # 테마 컨텍스트
│   ├── config-provider.tsx # UserSystem 컨텍스트
│   └── NormalizedConversation/ # 대화 UI
│
├── contexts/               # React Context 제공자
│   ├── UserSystemProvider.tsx  # 글로벌 설정/환경
│   ├── ProjectContext.tsx      # 현재 프로젝트 데이터
│   ├── project-context.tsx     # 대안/레거시 프로젝트 컨텍스트
│   ├── search-context.tsx      # 글로벌 검색 상태
│   ├── ReviewProvider.tsx      # 리뷰/승인 워크플로우
│   ├── ExecutionProcessesContext.tsx # 프로세스 실행 상태
│   ├── ProcessSelectionContext.tsx   # 선택된 프로세스 ID
│   ├── ClickedElementsProvider.tsx   # 클릭된 UI 요소
│   ├── ApprovalFormContext.tsx       # 승인 폼 상태
│   ├── RetryUiContext.tsx            # 재시도 UI 상태
│   ├── TabNavigationContext.tsx      # 탭 네비게이션 상태
│   └── EntriesContext.tsx            # 범용 항목 컨텍스트
│
├── hooks/                  # 커스텀 React 훅 (~30개, 2800 LOC)
│   ├── useProjectTasks.ts      # WebSocket 작업 스트림
│   ├── useDiffStream.ts        # WebSocket diff 스트림
│   ├── useExecutionProcesses.ts # WebSocket 프로세스 스트림
│   ├── useJsonPatchWsStream.ts  # 범용 JSON Patch WebSocket
│   ├── useAttemptExecution.ts   # 실행 상태
│   ├── useTaskAttempts.ts       # 작업 시도 페칭
│   ├── useTaskAttempt.ts        # 단일 작업 시도
│   ├── useTaskMutations.ts      # 작업 CRUD 작업
│   ├── useLogStream.ts          # 프로세스 로그 스트리밍
│   ├── useDiffViewStore.ts      # Diff 뷰 선호도
│   ├── useExecutionProcesses.ts # 프로세스 상태
│   ├── useOpenProjectInEditor.ts # IDE 실행
│   ├── useMediaQuery.ts         # 반응형 쿼리
│   ├── useBranchStatus.ts       # Git 브랜치 상태
│   ├── useRebase.ts             # Git 리베이스 작업
│   ├── usePush.ts               # Git 푸시 작업
│   ├── useChangeTargetBranch.ts # Git 브랜치 타겟
│   ├── useRenameBranch.ts       # Git 브랜치 이름 변경
│   ├── useAttemptCreation.ts    # 새 시도 생성
│   ├── useAttemptBranch.ts      # 시도 브랜치 정보
│   ├── useNavigateWithSearch.ts # 검색 매개변수로 네비게이션
│   ├── useShowcasePersistence.ts # 기능 쇼케이스 상태
│   ├── useConversationHistory.ts # 대화/채팅 기록
│   └── ... ~10개 이상 훅
│
├── i18n/                   # 국제화
│   ├── locales/            # 번역 파일 (en, ja, es, ko)
│   └── config.ts           # i18n 설정
│
├── lib/                    # 유틸리티 라이브러리 (8개 파일)
│   ├── api.ts              # 889 LOC - 15개 이상 API 객체가 있는 API 클라이언트
│   ├── types.ts            # 타입 헬퍼
│   ├── utils.ts            # 일반 유틸리티
│   ├── paths.ts            # URL 경로 빌더
│   ├── modals.ts           # 모달 헬퍼
│   ├── openTaskForm.ts     # 작업 폼 런처
│   ├── conflicts.ts        # Git 충돌 유틸리티
│   └── mcp-strategies.ts   # MCP 통합 전략
│
├── pages/                  # 라우트 레벨 페이지
│   ├── projects.tsx        # 프로젝트 리스트/상세 라우터
│   ├── project-tasks.tsx   # 작업 칸반 및 패널 (복잡한 컴포넌트)
│   ├── full-attempt-logs.tsx # 전체 페이지 로그 뷰
│   └── settings/           # 설정 페이지
│       ├── GeneralSettings.tsx
│       ├── ProjectSettings.tsx
│       ├── AgentSettings.tsx
│       ├── McpSettings.tsx
│       └── SettingsLayout.tsx
│
├── stores/                 # Zustand 스토어
│   ├── useDiffViewStore.ts     # Diff 뷰 모드 및 공백 설정
│   ├── useTaskDetailsUiStore.ts # 작업 상세 UI 상태
│   └── useExpandableStore.ts    # 확장 가능 섹션 상태
│
├── styles/                 # CSS 파일
│   ├── index.css           # 메인 스타일 (Tailwind, 테마 토큰)
│   ├── diff-style-overrides.css # 커스텀 diff 스타일링
│   └── edit-diff-overrides.css  # 편집 diff 스타일링
│
├── types/                  # 커스텀 TypeScript 타입
│   ├── modals.ts           # 모달 인자 타입
│   ├── logs.ts             # 로그 관련 타입
│   ├── tabs.ts             # 탭 네비게이션 타입
│   ├── showcase.ts         # 기능 쇼케이스 타입
│   ├── modal-args.d.ts     # 모달 인자 선언
│   └── virtual-executor-schemas.d.ts # Vite 가상 모듈 타입
│
├── utils/                  # 유틸리티 함수
│   ├── status-labels.ts    # 작업 상태 UI 라벨
│   ├── theme.ts            # 테마 유틸리티
│   ├── string.ts           # 문자열 조작
│   ├── extToLanguage.ts    # 파일 확장자 → 언어 매핑
│   ├── script-placeholders.ts # 스크립트 템플릿 플레이스홀더
│   ├── companion-install-task.ts # 웹 컴패니언 설정
│   ├── previewBridge.ts    # 미리보기 iframe 통신
│   ├── streamJsonPatchEntries.ts # JSON Patch 스트리밍
│   └── markdownImages.ts   # 마크다운 이미지 처리
│
├── config/                 # 설정 파일
│   └── showcases.ts        # 기능 쇼케이스 정의
│
├── constants/              # 애플리케이션 상수
│   └── processes.ts        # 프로세스 관련 상수
│
├── App.tsx                 # 라우팅이 있는 메인 앱 컴포넌트
├── main.tsx                # 진입점 (2800+ LOC의 의존성)
└── keyboard/               # 키보드 단축키 (암시적, 페이지에서 임포트됨)
```

**총 프론트엔드 파일:** 239개 TypeScript/TSX 파일

---

## 3. 컴포넌트 아키텍쳐

### 3.1 컴포넌트 패턴

#### **컴포지션 접근 방식**
- 상속보다 컴포지션을 많이 사용
- Context API를 통해 prop drilling 최소화
- 상태 및 로직 추출을 위한 커스텀 훅

#### **컴포넌트 타입**

**1. 페이지 컴포넌트 (라우트 레벨)**
```typescript
// src/pages/projects.tsx - 단순 라우터
// src/pages/project-tasks.tsx - 상태 관리가 있는 복잡한 컴포넌트
// src/pages/settings/* - 설정 페이지
```

**2. 레이아웃 컴포넌트 (구조적)**
```typescript
// NormalLayout.tsx - 네비바가 있는 메인 앱 셸
interface NormalLayoutProps {
  children: React.ReactNode;
  shouldHideNavbar?: boolean;
}

// TasksLayout.tsx - 반응형 칸반 + 패널
interface TasksLayoutProps {
  kanban: ReactNode;
  attempt: ReactNode;
  aux: ReactNode;
  isPanelOpen: boolean;
  mode: LayoutMode;
  isMobile?: boolean;
  rightHeader?: ReactNode;
}

// ResponsiveTwoPane.tsx - 범용 2-패널 레이아웃
```

**3. 기능 컴포넌트 (비즈니스 로직)**
```typescript
// TaskKanbanBoard.tsx - 드래그 앤 드롭 칸반 보드
interface TaskKanbanBoardProps {
  tasks: TaskWithAttemptStatus[];
  projectId: string;
  onTaskClick: (task: Task) => void;
}

// DiffsPanel.tsx - Git 작업이 있는 Diff 보기
// PreviewPanel.tsx - 미리보기 서버 출력
// ProcessesTab.tsx - 실행 프로세스 리스트
```

**4. UI 컴포넌트 (재사용 가능)**
```typescript
// shadcn/ui 프리미티브: Button, Card, Dialog 등
// 커스텀 칸반 컴포넌트
// 정렬/필터링이 있는 데이터 테이블
// Lexical 기반 리치 텍스트 에디터
```

**5. 다이얼로그 컴포넌트 (모달)**
```typescript
// nice-modal-react를 사용하는 25개 이상 다이얼로그
// 모달 결과를 위한 Promise 기반 API
// 기능별 다이얼로그 (작업, 프로젝트, 설정, 인증)
```

### 3.2 재사용 가능한 컴포넌트 라이브러리 (shadcn/ui)

**사용 중인 핵심 컴포넌트:**
```
- Button, Badge, Alert, Breadcrumb
- Card (CardHeader, CardContent, CardDescription)
- Dialog, Dropdown Menu, Tooltip
- Select, Input, Textarea, Checkbox, Label
- Tabs, Toggle, Toggle Group
- Table (정렬/필터링이 있는 DataTable)
- Alert, Accordion
```

**커스텀 shadcn 확장:**
- 드래그 앤 드롭 지원이 있는 향상된 칸반
- JSON Schema 폼 템플릿 및 위젯
- 리치 텍스트용 TitleDescriptionEditor
- 파일 선택용 MultiFileSearchTextarea

### 3.3 주요 컴포넌트 Props 패턴

```typescript
// Task Card
interface TaskCardProps {
  task: TaskWithAttemptStatus;
  index: number;
  status: string;
  onViewDetails: (task: Task) => void;
  isOpen?: boolean;
  projectId: string;
}

// Layout
interface TasksLayoutProps {
  kanban: ReactNode;
  attempt: ReactNode;
  aux: ReactNode;
  isPanelOpen: boolean;
  mode: LayoutMode;
  isMobile?: boolean;
  rightHeader?: ReactNode;
}

// Virtualized Log Viewer
interface ProcessLogsViewerProps {
  logs: LogEntry[];
  isLoading: boolean;
  atBottom: boolean;
  setAtBottom: (value: boolean) => void;
}
```

---

## 4. 상태 관리 전략

### 4.1 로컬 상태 관리

**React.useState:**
- 폼 상태, UI 토글, 로컬 데이터에 사용
```typescript
const [isOpen, setIsOpen] = useState(false);
const [formData, setFormData] = useState<FormData>(initialData);
```

**useCallback:**
- 컴포넌트 전체에서 메모이제이션된 이벤트 핸들러
```typescript
const handleClick = useCallback(() => {
  // 이벤트 처리
}, [dependencies]);
```

**useMemo:**
- 계산된 값을 위한 성능 최적화
```typescript
const filteredTasks = useMemo(() => {
  return tasks.filter(task => task.status === selectedStatus);
}, [tasks, selectedStatus]);
```

### 4.2 Context API를 사용한 글로벌 상태

#### **UserSystemProvider**
```typescript
interface UserSystemContext {
  config: Config;
  environment: Environment;
  profiles: Record<string, ExecutorConfig>;
  capabilities: Record<string, BaseAgentCapability[]>;
  analyticsUserId: string;
  updateAndSaveConfig(updates: Partial<Config>): Promise<boolean>;
  reloadSystem(): Promise<void>;
}

// 사용법
const { config, updateAndSaveConfig } = useUserSystem();
```

#### **ProjectContext**
```typescript
interface ProjectContextType {
  projectId: string | undefined;
  project: Project | undefined;
  isLoading: boolean;
  error: Error | null;
}

// 사용법
const { project, isLoading } = useProject();
```

#### **SearchContext**
```typescript
interface SearchContextType {
  query: string;
  setQuery: (query: string) => void;
  focusInput: () => void;
}
```

#### **ThemeContext**
```typescript
interface ThemeContextType {
  theme: ThemeMode;
  setTheme: (theme: ThemeMode) => void;
}
```

### 4.3 Zustand 스토어

#### **Diff View Store**
```typescript
interface DiffViewStore {
  mode: 'unified' | 'split';
  setMode(mode: DiffViewMode): void;
  toggle(): void;
  ignoreWhitespace: boolean;
  setIgnoreWhitespace(value: boolean): void;
}

// 사용법
const { mode, toggle } = useDiffViewStore();
```

#### **Task Details UI Store**
```typescript
interface TaskDetailsUiStore {
  // 작업별 UI 상태
  selectedTab: string;
  setSelectedTab: (tab: string) => void;
}
```

### 4.4 React Query 통합

**59개 사용:** 코드베이스 전체에서 `useQuery` 및 `useMutation` 사용

**기본 설정:**
```typescript
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,     // 5분
      refetchOnWindowFocus: false,
    },
  },
});
```

**API 객체 (15개 이상 API 그룹):**
```typescript
// 1. 프로젝트 API
projectsApi {
  getAll(): Promise<Project[]>
  getById(id: string): Promise<Project>
  create(data: CreateProject): Promise<Project>
  update(id: string, data: UpdateProject): Promise<Project>
  delete(id: string): Promise<void>
  openEditor(id: string, editor: EditorType): Promise<void>
  getBranches(id: string): Promise<Branch[]>
  searchFiles(id: string, query: string): Promise<FileSearchResult[]>
}

// 2. 작업 API
tasksApi {
  getAll(projectId: string): Promise<Task[]>
  getById(id: string): Promise<Task>
  create(data: CreateTask): Promise<Task>
  createAndStart(data: CreateAndStartTask): Promise<TaskAttempt>
  update(id: string, data: UpdateTask): Promise<Task>
  delete(id: string): Promise<void>
}

// 3. 시도 API
attemptsApi {
  getChildren(id: string): Promise<Task[]>
  getAll(taskId: string): Promise<TaskAttempt[]>
  get(id: string): Promise<TaskAttempt>
  create(data: CreateAttempt): Promise<TaskAttempt>
  // ... 더 많은 메서드
}

// 4. 실행 프로세스 API
executionProcessesApi { ... }

// 5. 파일시스템 API
fileSystemApi { ... }

// 6. 설정 API
configApi {
  getConfig(): Promise<Config>
  saveConfig(config: Config): Promise<boolean>
}

// 7. GitHub 인증 API
githubAuthApi {
  checkGithubToken(): Promise<boolean>
  startDeviceFlow(): Promise<DeviceFlowResponse>
  pollDeviceFlow(code: string): Promise<TokenResponse>
}

// ... 8~15개 이상 API 그룹
```

### 4.5 WebSocket을 통한 실시간 상태

#### **useProjectTasks - WebSocket JSON Patch 스트림**
```typescript
interface UseProjectTasksResult {
  tasks: TaskWithAttemptStatus[];
  tasksById: Record<string, TaskWithAttemptStatus>;
  isLoading: boolean;
  isConnected: boolean;
  error: string | null;
}

// 사용법
const { tasks, isLoading } = useProjectTasks(projectId);
```

#### **useDiffStream - Diff 업데이트**
```typescript
interface UseDiffStreamResult {
  diffs: Diff[];
  error: string | null;
}

// 사용법
const { diffs } = useDiffStream(attemptId, enabled);
```

#### **useExecutionProcesses - 프로세스 상태 업데이트**
```typescript
interface UseExecutionProcessesResult {
  executionProcesses: ExecutionProcess[];
  executionProcessesById: Record<string, ExecutionProcess>;
  isAttemptRunning: boolean;
  isLoading: boolean;
  isConnected: boolean;
}

// 사용법
const { executionProcesses, isAttemptRunning } =
  useExecutionProcesses(taskAttemptId);
```

### 4.6 JSON Patch 프로토콜

**RFC 6902 표준 사용:**
- 서버가 초기 상태 스냅샷 전송 (replace 작업)
- add/replace/remove 작업으로 실시간 업데이트
- 지수 백오프로 자동 재연결

**예시:**
```typescript
// 초기 데이터
{ op: "replace", path: "", value: { tasks: [...] } }

// 업데이트
{ op: "replace", path: "/tasks/0/status", value: "inprogress" }
{ op: "add", path: "/tasks/-", value: { id: "new", ... } }
{ op: "remove", path: "/tasks/5" }
```

---

## 5. API 통합

### 5.1 API 클라이언트 아키텍쳐 (889 LOC)

**에러 처리:**
```typescript
class ApiError<E = unknown> extends Error {
  public status?: number;
  public error_data?: E;

  constructor(message: string, status?: number, error_data?: E) {
    super(message);
    this.status = status;
    this.error_data = error_data;
  }
}

// 응답 타입
type Ok<T> = { success: true; data: T };
type Err<E> = { success: false; error: E | undefined; message?: string };
type Result<T, E> = Ok<T> | Err<E>;
```

**요청/응답 패턴:**
```typescript
// 요청 생성 헬퍼
async function makeRequest(
  url: string,
  options: RequestInit
): Promise<Response> {
  const response = await fetch(url, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
  });
  return response;
}

// 핸들러
async function handleApiResponse<T, E>(
  response: Response
): Promise<T> {
  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new ApiError(errorData.message, response.status, errorData);
  }
  return response.json();
}

async function handleApiResponseAsResult<T, E>(
  response: Response
): Promise<Result<T, E>> {
  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    return { success: false, error: errorData, message: errorData.message };
  }
  const data = await response.json();
  return { success: true, data };
}
```

### 5.2 타입 안정성

**Rust에서 자동 생성된 타입:**
- `npm run generate-types`로 생성된 `shared/types.ts` (338 LOC)
- CLAUDE.md의 명령: "`#[derive(TS)]`가 있는 Rust 구조체 수정 후 즉시 `npm run generate-types` 실행"
- `shared/types.ts` 수동 편집 절대 금지 (덮어써질 것임)

**타입 임포트:**
```typescript
import {
  Project,
  Task,
  TaskAttempt,
  TaskWithAttemptStatus,
  ExecutionProcess,
  Diff,
  BranchStatus,
  Config,
  Environment,
  ExecutorConfig,
  // ... 40개 이상 타입 임포트됨
} from 'shared/types';
```

### 5.3 API 패턴

**엔드포인트 카테고리:**

**1. 프로젝트:**
```typescript
GET    /api/projects
POST   /api/projects
GET    /api/projects/{id}
PUT    /api/projects/{id}
DELETE /api/projects/{id}
POST   /api/projects/{id}/open-editor
GET    /api/projects/{id}/branches
GET    /api/projects/{id}/search-files?q=...
```

**2. 작업:**
```typescript
GET    /api/tasks?project_id={projectId}
POST   /api/tasks
GET    /api/tasks/{id}
PUT    /api/tasks/{id}
DELETE /api/tasks/{id}
```

**3. 시도:**
```typescript
POST   /api/task-attempts
GET    /api/task-attempts/{id}
GET    /api/task-attempts/{id}/children
POST   /api/task-attempts/{id}/merge
POST   /api/task-attempts/{id}/create-pr
```

**4. 실행 프로세스:**
```typescript
GET    /api/execution-processes?task_attempt_id={attemptId}
GET    /api/execution-processes/{id}
GET    /api/execution-processes/{id}/logs (SSE)
```

**5. 설정:**
```typescript
GET    /api/config
PUT    /api/config
```

### 5.4 Vite 프록시 설정

```typescript
// vite.config.ts
server: {
  port: parseInt(process.env.FRONTEND_PORT || "3000"),
  proxy: {
    "/api": {
      target: `http://localhost:${process.env.BACKEND_PORT || "3001"}`,
      changeOrigin: true,
      ws: true, // WebSocket 프록시 활성화
    },
  },
}
```

---

## 6. 실시간 기능

### 6.1 Server-Sent Events (SSE) & WebSocket

#### **WebSocket JSON Patch Stream Hook**
```typescript
function useJsonPatchWsStream<T>(
  endpoint: string | undefined,
  enabled: boolean,
  initialData: () => T,
  options?: {
    injectInitialEntry?: (data: T) => void;
    deduplicatePatches?: (patches: Operation[]) => Operation[];
  }
): UseJsonPatchStreamResult<T> {
  const [data, setData] = useState<T>(initialData);
  const [isLoading, setIsLoading] = useState(true);
  const [isConnected, setIsConnected] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // WebSocket 연결 및 patch 적용 로직
  // ...

  return { data, isLoading, isConnected, error };
}
```

**기능:**
- 지수 백오프로 자동 재연결 (1s → 2s → 4s → 8s)
- RFC 6902 JSON Patch를 통한 상태 동기화
- 상태 불변성을 위한 딥 클로닝
- 타입 안정성을 위한 TypeScript 제네릭

#### **엔드포인트**
```typescript
// 작업 스트리밍
/api/tasks/stream/ws?project_id={projectId}

// Diff 스트리밍
/api/task-attempts/{id}/diff/ws

// 프로세스 스트리밍
/api/execution-processes/stream/ws?task_attempt_id={attemptId}

// 프로세스 로그 (SSE)
/api/events/processes/{processId}/logs
```

### 6.2 실시간 사용 사례

**1. 작업 리스트 업데이트**
- 실시간 작업 상태 변경
- 새 작업 생성
- 작업 삭제

**2. 프로세스 실행**
- 프로세스 상태 업데이트 (running → completed/failed)
- 실시간 로그 출력

**3. Diff 생성**
- 생성될 때 파일 변경 사항
- 통계 업데이트

### 6.3 Virtuoso를 사용한 로그 스트리밍

```typescript
// ProcessLogsViewer는 가상화된 로그에 Virtuoso 사용
function ProcessLogsViewer({ logs }: Props) {
  const virtuosoRef = useRef<VirtuosoHandle>(null);
  const [atBottom, setAtBottom] = useState(true);

  return (
    <Virtuoso
      ref={virtuosoRef}
      data={logs}
      itemContent={(index, entry) => formatLogLine(entry, index)}
      atBottomStateChange={setAtBottom}
      followOutput={atBottom ? 'smooth' : false}
      increaseViewportBy={{ top: 0, bottom: 600 }}
    />
  );
}
```

**기능:**
- 하단에 있을 때 자동 하단으로 스크롤
- 사용자가 위로 스크롤하면 스크롤 중지
- 대량 로그 버스트 처리 (10개 이상 라인)
- 부드러운 스크롤을 위한 최적화된 overscan

---

## 7. 라우팅 및 네비게이션

### 7.1 라우트 구조

```typescript
// App.tsx 라우트
const routes = [
  {
    path: '/',
    element: <NormalLayout><Projects /></NormalLayout>,
  },
  {
    path: '/projects',
    element: <NormalLayout><Projects /></NormalLayout>,
  },
  {
    path: '/projects/:projectId',
    element: <NormalLayout><ProjectDetail /></NormalLayout>,
  },
  {
    path: '/projects/:projectId/tasks',
    element: <NormalLayout><ProjectTasks /></NormalLayout>,
    children: [
      {
        path: ':taskId',
        element: <TaskDetails />, // 사이드 패널
      },
      {
        path: ':taskId/attempts/:attemptId',
        element: <AttemptDetails />,
      },
      {
        path: ':taskId/attempts/:attemptId/full',
        element: <FullPageLogs />, // 전체 페이지 로그
      },
    ],
  },
  {
    path: '/settings/*',
    element: <SettingsLayout />,
    children: [
      { path: 'general', element: <GeneralSettings /> },
      { path: 'projects', element: <ProjectSettings /> },
      { path: 'agents', element: <AgentSettings /> },
      { path: 'mcp', element: <McpSettings /> },
    ],
  },
  {
    path: '/mcp-servers',
    element: <Navigate to="/settings/mcp" replace />,
  },
];
```

### 7.2 네비게이션 패턴

**URL 기반 상태:**
```typescript
const [searchParams, setSearchParams] = useSearchParams();
const view = searchParams.get('view'); // 'preview' | 'diffs'
const shouldHideNavbar = view === 'preview' || view === 'diffs';
```

**커스텀 훅:**
```typescript
function useNavigateWithSearch() {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();

  return useCallback(
    (to: string) => {
      navigate(`${to}?${searchParams.toString()}`);
    },
    [navigate, searchParams]
  );
}
```

**브레드크럼 네비게이션:**
```
프로젝트 > 프로젝트 상세 > 작업 칸반 > 작업 상세
```

### 7.3 키보드 단축키

```typescript
// @/keyboard 모듈에서 임포트
// 단축키: 생성, 종료, 검색 포커스, 네비게이션, 상세 뷰, 삭제
// 칸반 뷰로 범위 지정
// react-hotkeys-hook 사용

// 예시
useHotkeys('ctrl+k, cmd+k', () => {
  openCreateTaskDialog();
});

useHotkeys('escape', () => {
  closeCurrentPanel();
});

useHotkeys('/', () => {
  focusSearchInput();
});
```

---

## 8. 스타일링 아키텍쳐

### 8.1 Tailwind CSS 설정

#### **CSS 변수 토큰 (index.css)**
```css
/* 라이트 테마 기본값 */
:root {
  --_background: 48 33% 97%;
  --_foreground: 222.2 84% 4.9%;
  --_primary: 222.2 47.4% 11.2%;
  --_secondary: 210 40% 96.1%;
  --_muted: 210 40% 96.1%;
  --_accent: 210 40% 96.1%;
  --_destructive: 0 84.2% 60.2%;
  --_border: 214.3 31.8% 91.4%;
  --_success: 142 76% 36%;
  --_warning: 38 92% 50%;
  --_info: 199 89% 48%;
  --_neutral: 0 0% 60%;
  --_console-*: /* 콘솔 색상 */
}

/* 다크 테마 */
.dark {
  --_background: 48 4% 16%;
  --_foreground: 48 7% 85%;
  /* ... */
}
```

#### **테마 설정 (tailwind.config.js)**
```javascript
module.exports = {
  darkMode: ["class"], // 클래스 기반 다크 모드
  theme: {
    extend: {
      colors: {
        border: "hsl(var(--_border))",
        input: "hsl(var(--_input))",
        ring: "hsl(var(--_ring))",
        background: "hsl(var(--_background))",
        foreground: "hsl(var(--_foreground))",
        primary: {
          DEFAULT: "hsl(var(--_primary))",
          foreground: "hsl(var(--_primary-foreground))",
        },
        secondary: { /* ... */ },
        destructive: { /* ... */ },
        success: { /* ... */ },
        warning: { /* ... */ },
        // ...
      },
      fontSize: {
        xs: '0.75rem',     // 1단계 다운시프트
        sm: '0.875rem',
        base: '1rem',
        lg: '1.125rem',
        xl: '1.25rem',
      },
      fontFamily: {
        'chivo-mono': ['Chivo Mono', 'Noto Emoji', 'monospace'],
      },
      borderRadius: {
        lg: 'var(--_radius)',
        md: 'calc(var(--_radius) - 2px)',
        sm: 'calc(var(--_radius) - 4px)',
      },
      keyframes: {
        'accordion-down': {
          from: { height: 0 },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: 0 },
        },
        pill: {
          '0%, 100%': { opacity: 0.5 },
          '50%': { opacity: 1 },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
        pill: 'pill 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      },
    },
  },
  plugins: [
    require("tailwindcss-animate"),
    require("@tailwindcss/container-queries"),
  ],
}
```

### 8.2 VS Code 통합
- CSS 변수가 VS Code 테마 토큰으로 폴백
- 에디터 확장(anyon-web-companion)과 통합
- 원활한 라이트/다크 모드 전환

### 8.3 반응형 디자인
```typescript
// 모바일 우선 접근 방식
const isMobile = useMediaQuery('(max-width: 1279px)');
const isDesktop = useMediaQuery('(min-width: 1280px)');

// 브레이크포인트: xl (1280px) 데스크톱 기능용
// 모바일 vs 데스크톱용 패널 기반 레이아웃
```

### 8.4 커스텀 스타일
```
diff-style-overrides.css (21.5 KB)
  - 커스텀 diff 뷰어 스타일링
  - 구문 강조 테마
  - 라인 번호 스타일

edit-diff-overrides.css (1.1 KB)
  - 편집 모드 diff 스타일링
```

---

## 9. 타입 시스템

### 9.1 TypeScript 설정

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "paths": {
      "@/*": ["./src/*"],
      "@dialogs/*": ["./src/components/dialogs/*"],
      "shared/*": ["../shared/*"]
    }
  }
}
```

### 9.2 경로 별칭

```json
{
  "@/*": ["./src/*"],
  "@dialogs/*": ["./src/components/dialogs/*"],
  "shared/*": ["../shared/*"]
}
```

**사용법:**
```typescript
import { Button } from '@/components/ui/button';
import { CreateTaskDialog } from '@dialogs/tasks/CreateTaskDialog';
import { Task, Project } from 'shared/types';
```

### 9.3 타입 정의

#### **Rust에서 자동 생성 (shared/types.ts)**
```typescript
// 엔티티
export type Project = {
  id: string;
  name: string;
  git_repo_path: string;
  setup_script: string | null;
  // ...
};

export type Task = {
  id: string;
  project_id: string;
  title: string;
  description: string | null;
  status: TaskStatus;
  created_at: Date;
  updated_at: Date;
  // ...
};

export type TaskWithAttemptStatus = Task & {
  has_in_progress_attempt: boolean;
  has_merged_attempt: boolean;
  last_attempt_failed: boolean;
  executor: string | null;
  // ...
};

// Enum
export enum ThemeMode {
  LIGHT = "light",
  DARK = "dark",
  SYSTEM = "system",
}

export enum EditorType {
  VS_CODE = "vscode",
  CURSOR = "cursor",
  WINDSURF = "windsurf",
  // ...
}

export type TaskStatus = "todo" | "inprogress" | "inreview" | "done" | "cancelled";

export enum BaseCodingAgent {
  CLAUDE_CODE = "CLAUDE_CODE",
  AMP = "AMP",
  GEMINI = "GEMINI",
  // ...
}

// 요청/응답
export type CreateTask = {
  project_id: string;
  title: string;
  description?: string | null;
  // ...
};

export type CreateFollowUpAttempt = {
  prompt: string;
  variant: string;
  image_ids?: string[];
  // ...
};
```

#### **커스텀 타입 파일**
```typescript
// types/modals.ts - 모달 인자 타입
export interface CreateTaskModalArgs {
  projectId: string;
  parentTaskAttemptId?: string;
}

// types/logs.ts - 로그 스트리밍 타입
export type LogEntry =
  | { type: 'STDOUT'; content: string }
  | { type: 'STDERR'; content: string };

// types/tabs.ts - 탭 네비게이션 타입
export type TabId = 'overview' | 'processes' | 'conversation' | 'diffs';

// lib/api.ts - API 응답 타입
export type Result<T, E> = Ok<T> | Err<E>;
export class ApiError<E = unknown> extends Error {
  public status?: number;
  public error_data?: E;
}
```

---

## 10. 빌드 및 개발 환경

### 10.1 Vite 설정

```typescript
// vite.config.ts
export default defineConfig({
  plugins: [
    react(),
    sentryVitePlugin({
      org: "slit",
      project: "anyon",
      authToken: process.env.SENTRY_AUTH_TOKEN,
    }),
    executorSchemasPlugin(), // executor schema용 커스텀 플러그인
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
      shared: path.resolve(__dirname, "../shared"),
    },
  },
  server: {
    port: parseInt(process.env.FRONTEND_PORT || "3000"),
    proxy: {
      "/api": {
        target: `http://localhost:${process.env.BACKEND_PORT || "3001"}`,
        changeOrigin: true,
        ws: true, // WebSocket 프록시
      },
    },
    fs: {
      allow: [
        path.resolve(__dirname, "."),
        path.resolve(__dirname, ".."),
      ],
    },
    open: process.env.VITE_OPEN === "true",
  },
  build: {
    sourcemap: true,
  },
});
```

### 10.2 Vite 플러그인: Executor Schemas

```typescript
// shared/schemas/에서 JSON schema를 동적으로 로드
// virtual:executor-schemas 가상 모듈 생성
// executor 설정 폼에 사용
```

### 10.3 NPM Scripts

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "check": "tsc --noEmit",
    "lint": "eslint . --ext ts,tsx --max-warnings 110",
    "lint:fix": "eslint . --ext ts,tsx --fix",
    "format": "prettier --write src/**/*.{ts,tsx,js,json,css,md}",
    "format:check": "prettier --check src/**/*.{ts,tsx,js,json,css,md}"
  }
}
```

### 10.4 개발 워크플로우

**1. 전체 스택 시작:**
```bash
npm run dev
```

**수행 작업:**
1. 동적 포트 할당
2. 핫 리로드로 백엔드 시작 (`cargo watch`)
3. Vite 개발 서버로 프론트엔드 시작
4. 프론트엔드가 백엔드로 API 프록시
5. WebSocket 프록시 활성화
6. Hot Module Replacement (HMR) 활성화

**2. 개별 서버:**
```bash
npm run backend:dev          # 핫 리로드가 있는 Rust
npm run frontend:dev         # 핫 리로드가 있는 Vite
```

### 10.5 프로덕션 빌드

```bash
# 프론트엔드 빌드
cd frontend && npm run build
```

**빌드:**
- TypeScript 컴파일
- 최소화로 Vite 번들링
- 자산 해싱
- Sentry에 소스 맵 업로드
- 출력: `frontend/dist/`

---

## 11. 주요 기능 구현 상세

### 11.1 작업 관리 UI

#### **칸반 보드 (TaskKanbanBoard.tsx)**
```typescript
interface TaskKanbanBoardProps {
  tasks: TaskWithAttemptStatus[];
  projectId: string;
  onTaskClick: (task: Task) => void;
}

function TaskKanbanBoard({ tasks, projectId, onTaskClick }: Props) {
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor)
  );

  return (
    <DndContext
      sensors={sensors}
      onDragEnd={handleDragEnd}
    >
      <div className="flex gap-4">
        {['todo', 'inprogress', 'inreview', 'done', 'cancelled'].map(status => (
          <Column key={status} status={status}>
            <SortableContext items={getTasksByStatus(status)}>
              {getTasksByStatus(status).map(task => (
                <TaskCard
                  key={task.id}
                  task={task}
                  onViewDetails={onTaskClick}
                />
              ))}
            </SortableContext>
          </Column>
        ))}
      </div>
    </DndContext>
  );
}
```

**기능:**
- 상태 열: todo, inprogress, inreview, done, cancelled
- @dnd-kit을 사용한 드래그 앤 드롭 재정렬
- 작업 카드 표시:
  - 제목 (2줄로 줄 클램핑)
  - 상태 표시기 (진행 중 스피너, 병합됨 체크마크, 실패 X)
  - 부모 작업 네비게이션

#### **작업 카드 (TaskCard.tsx)**
```typescript
interface TaskCardProps {
  task: TaskWithAttemptStatus;
  index: number;
  status: string;
  onViewDetails: (task: Task) => void;
  isOpen?: boolean;
  projectId: string;
}

function TaskCard({ task, onViewDetails }: Props) {
  return (
    <Card
      onClick={() => onViewDetails(task)}
      className="cursor-pointer hover:bg-accent"
    >
      <CardHeader>
        <CardTitle className="line-clamp-2">{task.title}</CardTitle>
        <div className="flex items-center gap-2">
          {task.has_in_progress_attempt && <Spinner />}
          {task.has_merged_attempt && <Check />}
          {task.last_attempt_failed && <X />}
        </div>
      </CardHeader>
    </Card>
  );
}
```

### 11.2 프로세스 로그 스트리밍

#### **가상화된 로그 뷰어**
```typescript
function ProcessLogsViewer({ logs, isLoading }: Props) {
  const virtuosoRef = useRef<VirtuosoHandle>(null);
  const [atBottom, setAtBottom] = useState(true);

  const formatLogLine = (entry: LogEntry, index: number) => {
    // fancy-ansi를 통한 ANSI 색상 파싱
    const { html } = parseAnsi(entry.content);

    return (
      <div
        key={index}
        className={cn(
          'font-mono text-sm',
          entry.type === 'STDERR' ? 'text-red-500' : 'text-foreground'
        )}
        dangerouslySetInnerHTML={{ __html: html }}
      />
    );
  };

  return (
    <Virtuoso
      ref={virtuosoRef}
      data={logs}
      itemContent={formatLogLine}
      atBottomStateChange={setAtBottom}
      followOutput={atBottom ? 'smooth' : false}
      increaseViewportBy={{ top: 0, bottom: 600 }}
    />
  );
}
```

**기능:**
- 10,000개 이상 라인 로그에 Virtuoso 사용
- 하단으로 자동 스크롤
- 하단에 있을 때 고정
- 수동 스크롤 감지
- fancy-ansi를 통한 ANSI 색상 파싱
- Stdout/stderr 채널 구분

### 11.3 작업 Diff 보기

#### **DiffsPanel (DiffsPanel.tsx)**
```typescript
function DiffsPanel({ attemptId }: Props) {
  const { diffs } = useDiffStream(attemptId, true);
  const { mode, ignoreWhitespace } = useDiffViewStore();

  return (
    <div className="flex flex-col h-full">
      <div className="flex items-center justify-between p-4">
        <div className="flex gap-2">
          <Toggle
            pressed={mode === 'split'}
            onPressedChange={() => toggle()}
          >
            Split View
          </Toggle>
          <Toggle
            pressed={ignoreWhitespace}
            onPressedChange={setIgnoreWhitespace}
          >
            Ignore Whitespace
          </Toggle>
        </div>
        <GitOperationsToolbar attemptId={attemptId} />
      </div>
      <div className="flex-1 overflow-auto">
        {diffs.map(diff => (
          <DiffView
            key={diff.oldPath || diff.newPath}
            diff={diff}
            mode={mode}
            ignoreWhitespace={ignoreWhitespace}
          />
        ))}
      </div>
    </div>
  );
}
```

**기능:**
- Unified 또는 split diff 뷰 모드
- 공백 무시 토글
- 통계가 있는 파일 레벨 diff
- Git 작업 툴바 (merge, push, rebase 등)
- 충돌 감지 및 해결

**Diff 데이터 구조:**
```typescript
export type Diff = {
  change: DiffChangeKind; // 'added' | 'deleted' | 'modified' | ...
  oldPath: string | null;
  newPath: string | null;
  oldContent: string | null;
  newContent: string | null;
  contentOmitted: boolean;
  additions: number | null;
  deletions: number | null;
};
```

### 11.4 미리보기 서버 통합

**PreviewPanel:**
- 개발 서버 상태 표시
- 라이브 미리보기 iframe
- 서버 출력 로그
- 연결 상태

### 11.5 인증 플로우

#### **GitHub OAuth Device Flow**
```typescript
function GitHubLoginDialog() {
  const [deviceCode, setDeviceCode] = useState<string | null>(null);
  const [userCode, setUserCode] = useState<string | null>(null);

  const startFlow = async () => {
    const response = await githubAuthApi.startDeviceFlow();
    setDeviceCode(response.device_code);
    setUserCode(response.user_code);
    window.open(response.verification_uri, '_blank');
  };

  useEffect(() => {
    if (!deviceCode) return;

    const interval = setInterval(async () => {
      const result = await githubAuthApi.pollDeviceFlow(deviceCode);
      if (result.success) {
        // 토큰 저장
        clearInterval(interval);
      }
    }, 5000);

    return () => clearInterval(interval);
  }, [deviceCode]);

  return (
    <Dialog>
      <DialogContent>
        <h2>GitHub로 로그인</h2>
        {userCode && (
          <div>
            <p>코드: {userCode}</p>
            <Button onClick={startFlow}>GitHub에서 인증</Button>
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

**단계:**
1. Device flow 시작: `githubAuthApi.startDeviceFlow()`
2. 완료 폴링: `githubAuthApi.pollDeviceFlow()`
3. 토큰 검증: `githubAuthApi.checkGithubToken()`
4. 설정에 토큰 저장

---

## 12. 개발 모범 사례

### 12.1 성능 최적화

**1. 메모이제이션**
```typescript
// React.memo()로 컴포넌트 메모이제이션
const TaskCard = React.memo(function TaskCard({ task }: Props) {
  return <Card>...</Card>;
});

// useMemo()로 계산 메모이제이션
const filteredTasks = useMemo(() => {
  return tasks.filter(task => task.status === selectedStatus);
}, [tasks, selectedStatus]);

// useCallback()로 함수 메모이제이션
const handleClick = useCallback(() => {
  // 이벤트 처리
}, [dependencies]);
```

**2. 코드 분할**
```typescript
// React Router 지연 로딩
const Settings = lazy(() => import('./pages/settings'));

<Route
  path="/settings"
  element={
    <Suspense fallback={<Loading />}>
      <Settings />
    </Suspense>
  }
/>
```

**3. 가상화**
```typescript
// 대형 리스트에 Virtuoso 사용
<Virtuoso
  data={logs}
  itemContent={(index, entry) => <LogLine entry={entry} />}
/>

// 그리드에 react-window 사용
<FixedSizeGrid
  columnCount={5}
  rowCount={100}
  columnWidth={100}
  rowHeight={35}
>
  {Cell}
</FixedSizeGrid>
```

**4. 패널 지속성**
```typescript
// LocalStorage에 패널 크기
const [panelSizes, setPanelSizes] = useLocalStorage('panelSizes', {
  left: 50,
  right: 50,
});
```

**5. 쿼리 캐싱**
```typescript
// 5분 stale time으로 React Query
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000,
    },
  },
});
```

### 12.2 에러 처리

**Sentry 통합:**
```typescript
Sentry.init({
  dsn: "...",
  integrations: [
    new Sentry.BrowserTracing(),
  ],
});

// 에러 경계
<Sentry.ErrorBoundary fallback={<ErrorFallback />}>
  <App />
</Sentry.ErrorBoundary>
```

**ApiError 커스텀 클래스:**
```typescript
class ApiError<E = unknown> extends Error {
  public status?: number;
  public error_data?: E;

  constructor(message: string, status?: number, error_data?: E) {
    super(message);
    this.status = status;
    this.error_data = error_data;
  }
}
```

### 12.3 코드 구성

- 기능 기반 폴더 구조
- `lib/` 및 `utils/`의 공유 유틸리티
- 글로벌 상태용 Context API
- 로컬 스토어용 Zustand
- 로직 추출용 커스텀 훅

### 12.4 테스트

- 타입 체크를 위한 TypeScript 컴파일러
- 코드 품질을 위한 ESLint
- 포맷팅을 위한 Prettier
- i18n 린팅 (LINT_I18N=true)
- 단위 테스트 언급 없음 (TypeScript + 린팅 주요 검증)

### 12.5 국제화

```typescript
// i18next로 번역
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation('tasks');
  return <h1>{t('title')}</h1>;
}

// 브라우저 언어 감지
i18n.use(LanguageDetector).init({
  fallbackLng: 'en',
  supportedLngs: ['en', 'ja', 'es', 'ko'],
});
```

### 12.6 키보드 단축키

```typescript
import { useHotkeys } from 'react-hotkeys-hook';

function TaskKanban() {
  // 작업 생성 (Ctrl/Cmd+K)
  useHotkeys('ctrl+k, cmd+k', () => {
    openCreateTaskDialog();
  });

  // 네비게이션 (화살표 키)
  useHotkeys('up', () => selectPreviousTask());
  useHotkeys('down', () => selectNextTask());

  // 상세 정보 열기
  useHotkeys('enter', () => openTaskDetails());

  // 삭제
  useHotkeys('del', () => deleteSelectedTask());

  // 종료
  useHotkeys('escape', () => closePanel());

  // 검색 포커스
  useHotkeys('/', () => focusSearchInput());
}
```

---

## 13. 성능 최적화 전략

### 13.1 번들 크기 최적화

**코드 분할:**
```typescript
// 라우트 기반 분할
const Settings = lazy(() => import('./pages/settings'));
const ProjectTasks = lazy(() => import('./pages/project-tasks'));

// 동적 임포트
const loadDialog = () => import('./components/dialogs/CreateTaskDialog');
```

**트리 쉐이킹:**
- ES 모듈 임포트/내보내기 사용
- Lodash에서 개별 함수 임포트
- 사용하지 않는 의존성 제거

### 13.2 렌더링 최적화

**React.memo:**
```typescript
const TaskCard = React.memo(function TaskCard({ task }: Props) {
  return <Card>...</Card>;
}, (prevProps, nextProps) => {
  return prevProps.task.id === nextProps.task.id &&
         prevProps.task.status === nextProps.task.status;
});
```

**가상화:**
- 대형 리스트에 react-virtuoso
- 그리드에 react-window
- 메시지 리스트에 @virtuoso.dev/message-list

### 13.3 네트워크 최적화

**React Query 캐싱:**
```typescript
// 5분 stale time
staleTime: 5 * 60 * 1000

// 윈도우 포커스 시 refetch 비활성화
refetchOnWindowFocus: false

// 요청 중복 제거
queryClient.setQueryDefaults(['tasks'], {
  structuralSharing: true,
});
```

**WebSocket 재연결 전략:**
```typescript
// 지수 백오프: 1s → 2s → 4s → 8s (최대)
const reconnectDelay = Math.min(1000 * Math.pow(2, attempts), 8000);
```

### 13.4 이미지 최적화

- 적절한 포맷 사용 (WebP, AVIF)
- 지연 로딩
- 응답형 이미지 (`srcset`)

---

## 요약

Anyon 프론트엔드는 다음을 갖춘 정교한 React 애플리케이션입니다:

1. **현대적 기술 스택**: React 18, Vite, TypeScript, Tailwind CSS
2. **고급 상태 관리**: React Query + Zustand + Context API
3. **실시간 기능**: JSON Patch 스트림을 위한 WebSocket
4. **풍부한 UI 컴포넌트**: shadcn/ui + 커스텀 칸반, 리치 텍스트 에디터
5. **타입 안정성**: Rust 백엔드에서 자동 생성된 타입
6. **성능**: 가상화, 메모이제이션, 코드 분할
7. **개발자 경험**: 핫 리로드, 소스 맵, 포괄적인 린팅
8. **분석 & 에러 추적**: PostHog + Sentry 통합
9. **국제화**: 브라우저 감지가 있는 다국어 지원
10. **확장성**: 다이얼로그 시스템, 커스텀 훅, 모듈식 아키텍쳐

**핵심 아키텍쳐 강점:** 컨텍스트, 훅, 모듈식 컴포넌트를 통한 관심사 분리로 쉬운 기능 추가 및 테스트가 가능합니다.
