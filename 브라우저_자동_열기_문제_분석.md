# 브라우저 자동 열기 문제 상세 분석

## 📍 문제 발생 위치

브라우저 자동 열기는 현재 **2곳**에서 발생합니다:

### 1. 서버 시작 시 자동 브라우저 열기
**위치**: `crates/server/src/main.rs:95-106`

```rust
if !cfg!(debug_assertions) {
    tracing::info!("Opening browser...");
    tokio::spawn(async move {
        if let Err(e) = open_browser(&format!("http://127.0.0.1:{actual_port}")).await {
            tracing::warn!(
                "Failed to open browser automatically: {}. Please open http://127.0.0.1:{} manually.",
                e,
                actual_port
            );
        }
    });
}
```

**동작 방식:**
- 서버가 시작되면 자동으로 `http://127.0.0.1:{포트}`를 브라우저에서 엽니다
- `debug_assertions`가 false일 때만 실행됩니다 (즉, 릴리즈 빌드에서만)
- `open_browser()` 함수를 사용하여 로컬 시스템의 기본 브라우저를 엽니다

**웹 버전에서의 문제:**
- 서버가 클라우드에 있으므로 사용자의 로컬 브라우저를 열 수 없습니다
- `open_browser()` 함수는 서버의 로컬 시스템에서 브라우저를 열려고 시도하므로 실패합니다
- 에러가 발생하지만 서버는 계속 실행되므로 큰 문제는 아닙니다
- 하지만 불필요한 에러 로그가 생성됩니다

---

### 2. PR 생성 시 자동 브라우저 열기
**위치**: `crates/server/src/routes/task_attempts.rs:845-847`

```rust
// Auto-open PR in browser
if let Err(e) = utils::browser::open_browser(&pr_info.url).await {
    tracing::warn!("Failed to open PR in browser: {}", e);
}
```

**동작 방식:**
- GitHub PR이 생성되면 자동으로 PR URL을 브라우저에서 엽니다
- PR URL은 예: `https://github.com/user/repo/pull/123`

**웹 버전에서의 문제:**
- 서버가 클라우드에 있으므로 사용자의 로컬 브라우저를 열 수 없습니다
- PR URL은 정상적으로 생성되지만 브라우저가 자동으로 열리지 않습니다
- 사용자는 PR URL을 받지만 브라우저가 자동으로 열리지 않아 혼란스러울 수 있습니다

---

## 🔍 `open_browser()` 함수 분석

**위치**: `crates/utils/src/browser.rs`

```rust
pub async fn open_browser(url: &str) -> Result<(), Box<dyn std::error::Error + Send + Sync>> {
    if is_wsl2() {
        // In WSL2, use PowerShell to open the browser
        tokio::process::Command::new("powershell.exe")
            .arg("-Command")
            .arg(format!("Start-Process '{url}'"))
            .spawn()?;
        Ok(())
    } else {
        // Use the standard open crate for other platforms
        open::that(url).map_err(|e| e.into())
    }
}
```

**동작 방식:**
1. WSL2 환경인지 확인
2. WSL2면 PowerShell을 사용하여 브라우저 열기
3. 아니면 `open` 크레이트를 사용하여 기본 브라우저 열기

**웹 버전에서의 문제:**
- 서버가 클라우드 리눅스 환경에 있으므로 `open` 크레이트가 작동하지 않을 수 있습니다
- 또는 서버의 브라우저(있는 경우)를 열려고 시도하지만, 사용자의 브라우저는 열 수 없습니다

---

## 💡 해결 방안 옵션

### 옵션 1: 완전히 비활성화 (권장)
**장점:**
- 가장 간단하고 명확함
- 웹 버전에서는 브라우저 자동 열기가 불필요함

**단점:**
- 사용자가 직접 URL을 복사해서 열어야 함

**구현 방법:**
- `isCloud` 체크를 추가하여 웹 버전에서는 브라우저 자동 열기 완전히 비활성화
- 또는 환경 변수로 제어 가능하게 만들기

---

### 옵션 2: 프론트엔드에서 처리 (PR 생성 시)
**장점:**
- PR 생성 시 프론트엔드가 URL을 받아서 클라이언트 측에서 브라우저 열기 가능
- 사용자 경험이 더 좋음

**단점:**
- 프론트엔드 코드 수정 필요
- 서버 시작 시 브라우저 열기는 여전히 문제

**구현 방법:**
- 백엔드에서 브라우저 자동 열기 제거
- 프론트엔드에서 PR URL을 받으면 `window.open()` 또는 `window.location.href`로 열기

---

### 옵션 3: 조건부 실행
**장점:**
- 로컬 버전에서는 여전히 작동
- 웹 버전에서만 비활성화

**단점:**
- `isCloud` 체크 로직 필요

**구현 방법:**
- `Deployment` trait에 `is_cloud()` 메서드 추가
- 또는 환경 변수로 체크

---

## 🎯 권장 사항

### 서버 시작 시 브라우저 자동 열기
- ✅ **완전히 비활성화 권장**
- 웹 버전에서는 사용자가 직접 URL을 입력해서 접속하므로 불필요함
- 로컬 버전에서도 필요하다면 환경 변수로 제어 가능하게 만들기

### PR 생성 시 브라우저 자동 열기
- ✅ **프론트엔드에서 처리 권장**
- 백엔드에서 브라우저 자동 열기 제거
- 프론트엔드에서 PR URL을 받으면 클라이언트 측에서 `window.open()`으로 열기
- 사용자 경험이 더 좋고, 웹 버전에서도 정상 작동

---

## ❓ 결정 필요 사항

1. **서버 시작 시 브라우저 자동 열기**
   - 완전히 비활성화할까요?
   - 아니면 로컬 버전에서만 작동하도록 조건부로 만들까요?

2. **PR 생성 시 브라우저 자동 열기**
   - 백엔드에서 완전히 제거하고 프론트엔드에서 처리할까요?
   - 아니면 백엔드에서만 비활성화할까요?

3. **`open_browser()` 함수**
   - 이 함수를 완전히 삭제할까요?
   - 아니면 나중을 위해 남겨둘까요?

