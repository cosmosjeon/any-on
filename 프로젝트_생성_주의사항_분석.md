# 프로젝트 생성 관련 주의사항 상세 분석

## 📍 현재 상황

프로젝트 생성은 **2가지 방식**으로 이루어집니다:

### 1. GitHub에서 프로젝트 생성
**위치**: `crates/server/src/routes/github.rs:95-211`

**동작 방식:**
```rust
// Get workspace path
let workspace_path = match resolve_workspace_path(&deployment).await {
    Ok(path) => path,
    Err(e) => {
        tracing::error!("Failed to get workspace path: {}", e);
        return Err(StatusCode::INTERNAL_SERVER_ERROR);
    }
};

let target_path = workspace_path.join(&payload.name);
```

**문제점:**
- `resolve_workspace_path()` 함수가 `deployment.workspace_dir()`을 호출합니다
- 하지만 `Deployment` trait에 `workspace_dir()` 메서드가 정의되어 있지 않습니다
- 실제로는 `config.workspace_dir`을 사용하는 것으로 보입니다

**확인 필요:**
- `workspace_dir()`이 실제로 어떻게 구현되어 있는지 확인 필요
- 웹 버전에서 올바른 서버 경로를 반환하는지 확인 필요

---

### 2. 일반 프로젝트 생성
**위치**: `crates/server/src/routes/projects.rs:47-137`

**동작 방식:**
```rust
// Validate and setup git repository
let path = std::path::absolute(expand_tilde(&git_repo_path))?;
```

**문제점:**
- 사용자가 직접 경로를 입력합니다 (`git_repo_path`)
- `expand_tilde()` 함수로 `~`를 홈 디렉토리로 확장합니다
- `std::path::absolute()`로 절대 경로로 변환합니다

**웹 버전에서의 문제:**
- 사용자가 로컬 경로를 입력할 수 있습니다 (예: `~/projects/my-app`)
- 하지만 웹 버전에서는 서버의 경로를 사용해야 합니다
- 사용자가 서버 경로를 모를 수 있습니다

---

## 🔍 상세 분석

### `resolve_workspace_path()` 함수
**위치**: `crates/server/src/routes/github.rs:220-224`

```rust
async fn resolve_workspace_path(deployment: &DeploymentImpl) -> Result<PathBuf, std::io::Error> {
    let base_path = deployment.workspace_dir();
    fs::create_dir_all(&base_path).await?;
    Ok(base_path)
}
```

**문제:**
- `deployment.workspace_dir()`을 호출하지만 이 메서드가 `Deployment` trait에 없습니다
- 실제 구현을 확인해야 합니다

---

### `expand_tilde()` 함수
**위치**: `crates/utils/src/path.rs` (추정)

**동작:**
- `~`를 사용자 홈 디렉토리로 확장합니다
- 예: `~/projects` → `/home/user/projects`

**웹 버전에서의 문제:**
- 서버의 홈 디렉토리를 사용하게 됩니다
- 여러 사용자가 있을 경우 문제가 될 수 있습니다

---

## 💡 해결 방안 옵션

### 옵션 1: 웹 버전에서는 GitHub에서만 프로젝트 생성 허용
**장점:**
- 가장 간단함
- 사용자가 경로를 신경 쓸 필요 없음
- 서버가 자동으로 적절한 경로에 저장

**단점:**
- 일반 프로젝트 생성 기능을 사용할 수 없음

**구현 방법:**
- 웹 버전에서는 일반 프로젝트 생성 UI를 비활성화
- GitHub에서 프로젝트 생성만 허용

---

### 옵션 2: 웹 버전에서 경로 입력을 서버 기준으로 제한
**장점:**
- 일반 프로젝트 생성도 사용 가능
- 사용자가 서버 경로를 입력하도록 안내

**단점:**
- 사용자가 서버 경로를 알아야 함
- 혼란스러울 수 있음

**구현 방법:**
- UI에서 "서버 경로를 입력하세요" 같은 안내 추가
- 기본 경로를 서버의 workspace 디렉토리로 설정
- `~` 확장을 서버 기준으로 처리

---

### 옵션 3: 웹 버전에서 경로 입력을 완전히 제거
**장점:**
- 사용자가 경로를 신경 쓸 필요 없음
- 서버가 자동으로 적절한 경로에 저장

**단점:**
- 기존 프로젝트를 추가하는 기능 사용 불가
- 새 프로젝트만 생성 가능

**구현 방법:**
- 웹 버전에서는 경로 입력 필드를 제거
- 서버가 자동으로 workspace 디렉토리에 저장
- 프로젝트 이름만 입력받음

---

## 🎯 권장 사항

### GitHub에서 프로젝트 생성
- ✅ **현재 방식 유지 가능**
- `resolve_workspace_path()`가 올바른 서버 경로를 반환하는지 확인만 필요
- 웹 버전에서도 정상 작동할 것으로 예상

### 일반 프로젝트 생성
- ✅ **옵션 3 권장** (경로 입력 완전히 제거)
- 웹 버전에서는 새 프로젝트만 생성 가능하도록 제한
- 기존 프로젝트 추가는 GitHub에서만 가능
- 사용자 경험이 더 좋음

---

## ❓ 결정 필요 사항

1. **일반 프로젝트 생성 기능**
   - 웹 버전에서 완전히 비활성화할까요?
   - 아니면 경로 입력을 서버 기준으로 제한할까요?

2. **기존 프로젝트 추가**
   - 웹 버전에서 기존 프로젝트를 추가하는 기능이 필요한가요?
   - 필요하다면 어떻게 처리할까요?

3. **`workspace_dir()` 구현**
   - 실제 구현을 확인하고 웹 버전에서 올바른 경로를 반환하는지 확인 필요

4. **파일 저장 위치**
   - 모든 파일이 서버 기준으로 저장되는지 확인 필요
   - 사용자별로 격리된 디렉토리를 사용할지 결정 필요

